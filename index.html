<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Teacher Absence Reporting Form 教师请假申请</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 40px auto;
      line-height: 1.5;
    }
    .class-section { 
      border: 1px solid #ddd; 
      padding: 10px; 
      margin-bottom: 10px; 
      border-radius: 8px;
    }
    .substitute-section, .makeup-section {
      display: none;
      margin-top: 6px;
      padding-left: 10px;
    }
    label {
      font-weight: 600;
      display: inline-block;
      margin-bottom: 4px;
    }
    input, select, button, textarea {
      padding: 6px;
      margin-top: 2px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      width: auto;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 6px;
    }
    button:hover {
      background-color: #45a049;
    }
    .logo {
      display: block;
      margin: 0 auto 8px auto;
      max-width: 90px;
    }
  </style>
</head>
<body>
  <img src="0.jpg" alt="Xilin Northwest Chinese School Logo" class="logo">
  <h2>Teacher Absence Reporting Form 教师请假申请</h2>

  <form id="absenceForm" action="https://docs.google.com/forms/d/e/1FAIpQLSeO_SfaykA3sor94Jda_65gTlZ866_08iyKW1q6v7jsw5ZjlA/formResponse" method="POST" target="_blank">
    <div class="form-group">
      <label for="teacherName">Teacher's Name 教师姓名:</label>
      <input type="text" id="teacherName" name="entry.877279940" required>
    </div>

    <div class="form-group">
      <label for="teacherEmail">Teacher's Email 教师邮箱:</label>
      <input type="email" id="teacherEmail" name="entry.231600313" required>
    </div>

    <div class="form-group">
      <label for="absenceDate">Date of Absence 请假日期:</label>
      <input type="date" id="absenceDate" name="entry.1331770806" required>
    </div>
    
    <div class="form-group">
      <label for="absenceReason">Absence Reason 请假原因:</label>
      <input id="absenceReason" name="entry.820131029" placeholder="Please provide the reason for absence" required>
    </div>    

    <div class="form-group">
      <br>
      <label>Plan for each class affected 填写受影响每一门课的计划 (最多 5 门课):</label>
    </div>
    
    <div id="classesContainer">
      <div class="class-section">
        <label>Class Code/Name 课程号/名 1:</label>
        <input type="text" name="classes[]" placeholder="Class name" required>

        <label>Arrangement Plan 处理安排:</label>
        <select name="absenceOptions[]" required>
          <option value="cancel">Cancel 课程取消</option>
          <option value="makeUp">Make Up 补课</option>
          <option value="substitute">Substitute Teacher 其他老师代课</option>
        </select>

        <div class="makeup-section">
          <label>Makeup Date 补课日期:</label>
          <input type="date" name="makeupDates[]" disabled>
          <label>Makeup Details 细节 (online, different time...):</label>
          <input type="text" name="makeupDetails[]" placeholder="Provide details for makeup class" disabled>
        </div>
        
        <div class="substitute-section">
          <label>Sub Teacher Name 代课教师:</label>
          <input type="text" name="substituteNames[]" placeholder="Enter substitute teacher name" disabled>
        </div>
      </div>
    </div>

    <button type="button" id="addClassBtn">Add Another Class 下一门课</button><br><br>
    
    <div class="form-group">
      <label for="additionalNote">Additional Note 备注:</label>
      <textarea id="additionalNote" name="entry.1802080225" rows="3" placeholder="Add any comments or notes here"></textarea>
    </div>

    <!-- Hidden Google Form entries for 5 classes -->
    <input type="hidden" name="entry.1499217619" id="entry_1">
    <input type="hidden" name="entry.389089946" id="entry_2">
    <input type="hidden" name="entry.1091424194" id="entry_3">
    <input type="hidden" name="entry.1776332206" id="entry_4">
    <input type="hidden" name="entry.2031923226" id="entry_5">

    <button type="submit">Submit 提交</button>
  </form>

  <script>
    function toggleFields(selectEl) {
      const classSection = selectEl.closest('.class-section');
      const subSection = classSection.querySelector('.substitute-section');
      const subInput = subSection.querySelector('input');
      const makeupSection = classSection.querySelector('.makeup-section');
      const makeupDate = makeupSection.querySelector('input[type="date"]');
      const makeupDetail = makeupSection.querySelector('input[type="text"]');

      if (selectEl.value === 'substitute') {
        subSection.style.display = 'block';
        subInput.disabled = false;

        makeupSection.style.display = 'none';
        makeupDate.value = '';
        makeupDate.disabled = true;
        makeupDetail.value = '';
        makeupDetail.disabled = true;
      } else if (selectEl.value === 'makeUp') {
        makeupSection.style.display = 'block';
        makeupDate.disabled = false;
        makeupDetail.disabled = false;

        subSection.style.display = 'none';
        subInput.value = '';
        subInput.disabled = true;
      } else {
        subSection.style.display = 'none';
        subInput.value = '';
        subInput.disabled = true;

        makeupSection.style.display = 'none';
        makeupDate.value = '';
        makeupDate.disabled = true;
        makeupDetail.value = '';
        makeupDetail.disabled = true;
      }
    }

    function addClass() {
      const container = document.getElementById('classesContainer');
      const count = container.querySelectorAll('.class-section').length;
      if (count >= 5) {
        alert("You can only add up to 5 classes (最多 5 门课).");
        return;
      }
      const index = count + 1;
      const newDiv = document.createElement('div');
      newDiv.className = 'class-section';
      newDiv.innerHTML = `
        <label>Class Code/Name 课程号/名 ${index}:</label>
        <input type="text" name="classes[]" placeholder="Class name" required>

        <label>Arrangement Plan 处理安排:</label>
        <select name="absenceOptions[]" required>
          <option value="cancel">Cancel 课程取消</option>
          <option value="makeUp">Make Up 补课</option>
          <option value="substitute">Substitute Teacher 其他老师代课</option>
        </select>

        <div class="makeup-section" style="display:none;">
          <label>Makeup Date 补课日期:</label>
          <input type="date" name="makeupDates[]" disabled>
          <label>Makeup Details 细节:</label>
          <input type="text" name="makeupDetails[]" placeholder="Provide details" disabled>
        </div>

        <div class="substitute-section" style="display:none;">
          <label>Sub Teacher Name 代课教师:</label>
          <input type="text" name="substituteNames[]" placeholder="Enter substitute teacher name" disabled>
        </div>
      `;
      container.appendChild(newDiv);

      const newSelect = newDiv.querySelector('select[name="absenceOptions[]"]');
      newSelect.addEventListener('change', () => toggleFields(newSelect));
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('select[name="absenceOptions[]"]').forEach(sel => {
        sel.addEventListener('change', () => toggleFields(sel));
        toggleFields(sel);
      });

      document.getElementById('addClassBtn').addEventListener('click', addClass);

      // Before form submit, combine class info into hidden fields
      document.getElementById('absenceForm').addEventListener('submit', (e) => {
        const classes = document.querySelectorAll('.class-section');
        for (let i = 0; i < 5; i++) {
          const hiddenInput = document.getElementById(`entry_${i + 1}`);
          if (i < classes.length) {
            const cls = classes[i];
            const name = cls.querySelector('input[name="classes[]"]').value.trim();
            const plan = cls.querySelector('select[name="absenceOptions[]"]').value;
            const makeupDate = cls.querySelector('input[name="makeupDates[]"]').value || '';
            const makeupDetails = cls.querySelector('input[name="makeupDetails[]"]').value || '';
            const subName = cls.querySelector('input[name="substituteNames[]"]').value || '';

            // Combine into one string per class
            hiddenInput.value = `${name}, ${plan}, ${makeupDate}, ${makeupDetails}, ${subName}`;
          } else {
            hiddenInput.value = "";
          }
        }
      });
    });
  </script>
</body>
</html>
